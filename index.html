<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compra Segura - Misoprostol 100% Original</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.5;
            padding: 15px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.2);
        }

        header h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }

        header p {
            font-size: 0.95rem;
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
        }

        .content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: space-between;
        }

        .calculator-container, .form-container, .info-container {
            flex: 1;
            min-width: 300px;
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .calculator-container {
            border-top: 4px solid #6a11cb;
        }

        .form-container {
            border-top: 4px solid #2575fc;
        }

        .info-container {
            border-top: 4px solid #00b09b;
        }

        h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title {
            color: #6a11cb;
            margin: 15px 0 10px 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .calculator-box {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e0e7ff;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #444;
            font-size: 0.9rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #6a11cb;
            box-shadow: 0 0 0 2px rgba(106, 17, 203, 0.1);
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.8rem;
            margin-top: 4px;
            display: none;
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }

        .row {
            display: flex;
            gap: 10px;
        }

        .row .form-group {
            flex: 1;
        }

        .pregnancy-result {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-top: 15px;
        }

        .weeks-display {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .delivery-options {
            margin-top: 15px;
            padding: 15px;
            background: #e8f4fc;
            border-radius: 8px;
            border: 1px solid #b3e0ff;
        }

        .delivery-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .delivery-option:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .delivery-option.selected {
            background: white;
            border: 2px solid #2575fc;
            box-shadow: 0 2px 8px rgba(37, 117, 252, 0.2);
        }

        .delivery-option input[type="radio"] {
            width: 18px;
            height: 18px;
        }

        .delivery-option .icon {
            font-size: 1.5rem;
            color: #2575fc;
        }

        .delivery-option .details {
            flex: 1;
        }

        .delivery-option .title {
            font-weight: 600;
            color: #2c3e50;
        }

        .delivery-option .description {
            font-size: 0.85rem;
            color: #666;
            margin-top: 2px;
        }

        .shipping-calculation {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #e0e7ff;
        }

        .shipping-result {
            background: linear-gradient(135deg, #2575fc 0%, #6a11cb 100%);
            color: white;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            text-align: center;
        }

        .shipping-result.hidden {
            display: none;
        }

        .shipping-cost {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .shipping-time {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .pix-section {
            background: linear-gradient(135deg, #2575fc 0%, #6a11cb 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }

        .pix-details {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
        }

        .pix-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.9rem;
        }

        .pix-item:last-child {
            border-bottom: none;
        }

        .pix-copy-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid white;
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            width: 100%;
            justify-content: center;
        }

        .pix-copy-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        button {
            width: 100%;
            padding: 20px;
            background: linear-gradient(135deg, #b7ff8d 0%, #174e01 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 20px;
        }

        button:hover {
            background: linear-gradient(135deg, #5a0db9 0%, #1c68e8 100%);
            transform: translateY(-2px);
        }

        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        .whatsapp-info {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }

        .whatsapp-number {
            font-size: 1.2rem;
            font-weight: bold;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 25px;
            display: inline-block;
            margin: 8px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .whatsapp-message-preview {
            background-color: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 0.85rem;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
        }

        .instructions {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #e0e0e0;
        }

        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .instructions ol {
            padding-left: 20px;
            font-size: 0.85rem;
        }

        .instructions li {
            margin-bottom: 6px;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .row {
                flex-direction: column;
                gap: 0;
            }
            
            header h1 {
                font-size: 1.5rem;
            }
            
            .weeks-display {
                font-size: 2rem;
            }
        }

        footer {
            text-align: center;
            margin-top: 25px;
            padding: 15px;
            color: #7f8c8d;
            font-size: 0.85rem;
            border-top: 1px solid #e0e0e0;
        }

        .notification {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 12px 18px;
            border-radius: 6px;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            font-size: 0.9rem;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.success {
            background: #2ecc71;
        }

        .notification.error {
            background: #e74c3c;
        }

        .notification.info {
            background: #3498db;
        }
        
        .required {
            color: #e74c3c;
        }
        
        .cep-search {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .cep-search input {
            flex: 1;
        }
        
        .cep-search button {
            width: auto;
            padding: 10px 15px;
            margin: 0;
            font-size: 0.9rem;
            white-space: nowrap;
            background: #3498db;
        }
        
        .cep-search button:hover {
            background: #2980b9;
        }
        
        .copy-btn-container {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        
        .copy-btn-container input {
            flex: 1;
        }
        
        .copy-btn-container button {
            width: auto;
            padding: 10px 15px;
            margin: 0;
            background: #2ecc71;
        }
        
        .copy-btn-container button:hover {
            background: #27ae60;
        }
        
        .no-data {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 20px;
        }
        
        .calculate-shipping-btn {
            background: #00b09b !important;
            margin-top: 10px !important;
        }
        
        .calculate-shipping-btn:hover {
            background: #00a187 !important;
        }
        
        .total-summary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }
        
        .total-amount {
            font-size: 2rem;
            font-weight: bold;
            margin: 8px 0;
        }
        
        .shipping-origin {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
            background: white;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
        }
        
        /* Estilos para a tabela de produtos */
        .products-table-container {
            margin-top: 15px;
            overflow-x: auto;
        }
        
        .products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            font-size: 0.9rem;
        }
        
        .products-table th {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 12px 8px;
            text-align: left;
            font-weight: 600;
        }
        
        .products-table td {
            padding: 10px 8px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .products-table tr:hover {
            background-color: #f8f9ff;
        }
        
        .products-table tr.selected {
            background-color: #e8f4fc;
            border-left: 4px solid #2575fc;
        }
        
        .product-radio {
            text-align: center;
        }
        
        .product-radio input[type="radio"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        
        .product-number {
            font-weight: bold;
            color: #6a11cb;
            text-align: center;
        }
        
        .product-price-cell {
            font-weight: bold;
            color: #2ecc71;
            text-align: right;
        }
        
        .product-selection-info {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
            color: white;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            text-align: center;
        }
        
        .selected-product-display {
            font-size: 1.2rem;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .no-product-selected {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            margin-top: 10px;
        }
        
        .product-calculator-box {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #e0e7ff;
        }
        
        .product-calculation {
            margin-top: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e0e0e0;
        }
        
        .product-calculation-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .product-calculation-item:last-child {
            border-bottom: none;
            font-weight: bold;
            color: #6a11cb;
            font-size: 1.1rem;
        }
        
        .product-calculation-total {
            font-size: 1.3rem;
            font-weight: bold;
            color: #e74c3c;
            text-align: center;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px dashed #ddd;
        }
        
        .pregnancy-info-box {
            background: #f0f7ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #cfe2ff;
        }
        
        .pregnancy-weeks-info {
            text-align: center;
            padding: 10px;
        }
        
        .pregnancy-weeks-number {
            font-size: 3rem;
            font-weight: bold;
            color: #6a11cb;
            margin: 10px 0;
        }
        
        .pregnancy-weeks-label {
            font-size: 1.1rem;
            color: #444;
            font-weight: 600;
        }
        
        .loading-cep {
            display: none;
            text-align: center;
            padding: 10px;
            color: #3498db;
        }
        
        .loading-cep.show {
            display: block;
        }
        
        .loading-cep i {
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
           <h1><i class="fa-solid fa-pills"></i> Compra Segura - Misoprostol 100% Original </h1>
            <p>Calcule quantas semanas você está e veja a quantidade recomendada <br> Suporte Total do inicio ao fim do procedimento</p>
        </header>

        <div class="content">
            <!-- Calculadora e Seleção de Produto -->
            <div class="calculator-container">
                <h2><i class="fas fa-calculator"></i> Calculadora de Semanas</h2>
                
                <div class="calculator-box">
                    <div class="form-group">
                        <label for="lastPeriod">Primeiro dia da última menstruação *</label>
                        <input type="date" id="lastPeriod" required>
                    </div>
                    
                    <!-- Data Atual OCULTA -->
                    <div class="form-group hidden">
                        <label for="currentDate">Data Atual *</label>
                        <input type="date" id="currentDate" required>
                    </div>
                    
                    <button type="button" id="calculateBtn">
                        <i class="fas fa-calculator"></i> Calcular Semanas
                    </button>
                </div>
                
                <!-- Resultado das Semanas de Gestação -->
                <div id="pregnancyResult" class="hidden">
                    <div class="pregnancy-info-box">
                        <div class="pregnancy-weeks-info">
                            <div class="pregnancy-weeks-number" id="weeksDisplay">0</div>
                            <div class="pregnancy-weeks-label">Semanas de Gestação</div>
                            <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                                Você está com aproximadamente <span id="weeksDisplayText">0</span> semanas de gestação.
                            </p>
                        </div>
                    </div>
                </div>
                
                <!-- Tabela de Produtos -->
                <div class="section-title" style="margin-top: 20px;">
                    <i class="fas fa-shopping-cart"></i> Tabela de Preços
                </div>
                
                <div class="products-table-container">
                    <table class="products-table">
                        <thead>
                            <tr>
                                <th style="width: 10%; text-align: center;">Escolher</th>
                                <th style="width: 40%;">Produto</th>
                                <th style="width: 50%;">Valor</th>
                            </tr>
                        </thead>
                        <tbody id="productsTableBody">
                            <!-- Produtos serão inseridos via JavaScript -->
                        </tbody>
                    </table>
                </div>
                
                <!-- Informação do Produto Selecionado -->
                <div id="selectedProductInfo" class="no-product-selected">
                    <i class="fas fa-info-circle" style="font-size: 1.5rem; margin-bottom: 10px; display: block;"></i>
                    <p>Selecione a quantidade desejada acima</p>
                </div>
                
                <!-- Cálculo do Produto + Frete -->
                <div id="productCalculation" class="hidden">
                    <div class="product-calculator-box">
                        <h3 style="color: #2c3e50; margin-bottom: 10px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-calculator"></i> Cálculo do Pedido
                        </h3>
                        
                        <div class="product-calculation">
                            <div class="product-calculation-item">
                                <span>Produto selecionado:</span>
                                <span id="calcProductName">-</span>
                            </div>
                            <div class="product-calculation-item">
                                <span>Valor do produto:</span>
                                <span id="calcProductPrice">R$ 0,00</span>
                            </div>
                            <div class="product-calculation-item">
                                <span>Frete SEDEX:</span>
                                <span id="calcShipping">R$ 0,00</span>
                            </div>
                            <div class="product-calculation-item">
                                <span>Total a pagar:</span>
                                <span id="calcTotal">R$ 0,00</span>
                            </div>
                            <div class="product-calculation-total" id="calcTotalDisplay">
                                TOTAL: R$ 0,00
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="noDataMessage" class="no-data">
                    <i class="fas fa-calculator" style="font-size: 2rem; margin-bottom: 10px; color: #ddd;"></i>
                    <p>Informe a data da sua última menstruação para calcular as semanas de gestação</p>
                </div>
            </div>

            <!-- Formulário -->
            <div class="form-container">
                <h2><i class="fas fa-user"></i> Dados Pessoais</h2>
                <form id="customerForm">
                    <div class="section-title">
                        <i class="fas fa-user"></i> Informações
                    </div>
                    
                    <div class="form-group">
                        <label for="name">Nome Completo *</label>
                        <input type="text" id="name" placeholder="Seu nome completo" required>
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <label for="email">E-mail *</label>
                            <input type="email" id="email" placeholder="seu@email.com" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">WhatsApp *</label>
                            <input type="tel" id="phone" placeholder="(85) 98461-4021" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="cpf">CPF *</label>
                        <input type="text" id="cpf" placeholder="000.000.000-00" required>
                        <div class="error-message" id="cpfError">CPF inválido</div>
                    </div>

                    <div class="section-title">
                        <i class="fas fa-map-marker-alt"></i> Endereço
                    </div>
                    
                    <div class="form-group">
                        <label for="cep">CEP *</label>
                        <div class="cep-search">
                            <input type="text" id="cep" placeholder="00000-000" required maxlength="9">
                            <button type="button" id="searchCep">
                                <i class="fas fa-search"></i> Buscar
                            </button>
                        </div>
                        <div class="error-message" id="cepError">CEP inválido</div>
                        <div class="loading-cep" id="loadingCep">
                            <i class="fas fa-spinner"></i> Buscando endereço...
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <label for="street">Rua *</label>
                            <input type="text" id="street" placeholder="Nome da rua" required>
                        </div>
                        <div class="form-group">
                            <label for="number">Número *</label>
                            <input type="text" id="number" placeholder="Nº" required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <label for="complement">Complemento</label>
                            <input type="text" id="complement" placeholder="Apto, Casa">
                        </div>
                        <div class="form-group">
                            <label for="neighborhood">Bairro *</label>
                            <input type="text" id="neighborhood" placeholder="Bairro" required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <label for="city">Cidade *</label>
                            <input type="text" id="city" placeholder="Cidade" required>
                        </div>
                        <div class="form-group">
                            <label for="state">Estado *</label>
                            <input type="text" id="state" placeholder="UF" required>
                        </div>
                    </div>

                    <!-- Opções de Entrega -->
                    <div class="delivery-options">
                        <h3><i class="fas fa-truck"></i> Opções de Entrega</h3>
                        
                        <div class="delivery-option selected" data-type="hand">
                            <input type="radio" name="delivery" id="deliveryHand" value="hand" checked>
                            <div class="icon">
                                <i class="fas fa-hand-holding-heart"></i>
                            </div>
                            <div class="details">
                                <div class="title">Receber em mãos (Motoboy Uber)</div>
                                <div class="description">Verificar Disponibilidade - Sem taxa de entrega</div>
                            </div>
                        </div>
                        
                        <div class="delivery-option" data-type="sedex">
                            <input type="radio" name="delivery" id="deliverySedex" value="sedex">
                            <div class="icon">
                                <i class="fas fa-shipping-fast"></i>
                            </div>
                            <div class="details">
                                <div class="title">Envio via SEDEX</div>
                                <div class="description">Entrega pelos Correios - Frete calculado por estado</div>
                            </div>
                        </div>
                    </div>

                    <!-- Cálculo do Frete SEDEX -->
                    <div id="shippingCalculation" class="shipping-calculation hidden">
                        <div class="form-group">
                            <label>Origem do Frete:</label>
                            <div class="shipping-origin">
                                <i class="fas fa-map-marker-alt"></i> São Paulo - SP
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Destino do Frete:</label>
                            <div class="shipping-origin">
                                <i class="fas fa-map-marker-alt"></i> <span id="destinationState">Estado não identificado</span>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Peso do Pacote (envelope)</label>
                            <input type="text" value="500g (tamanho padrão)" readonly>
                        </div>
                        
                        <button type="button" id="calculateShippingBtn" class="calculate-shipping-btn">
                            <i class="fas fa-calculator"></i> Calcular Frete SEDEX
                        </button>
                        
                        <div id="shippingResult" class="shipping-result hidden">
                            <div class="shipping-cost" id="shippingCost">R$ 0,00</div>
                            <div class="shipping-time" id="shippingTime">Prazo: 5-12 dias úteis</div>
                            <div style="font-size: 0.8rem; margin-top: 5px; opacity: 0.9;">
                                Com margem de segurança de 20%
                            </div>
                        </div>
                    </div>

                    <!-- Resumo Total -->
                    <div id="totalSummary" class="total-summary">
                        <h3><i class="fas fa-receipt"></i> Resumo do Valor</h3>
                        <div class="total-amount" id="totalAmount">R$ 0,00</div>
                        <div style="font-size: 0.9rem;" id="summaryDetails">
                            Selecione um produto da tabela
                        </div>
                    </div>

                    <!-- Informações de Pagamento PIX -->
                    <div class="pix-section">
                        <h3><i class="fas fa-money-bill-wave"></i> Pagamento via PIX</h3>
                        <div class="pix-details">
                            <div class="pix-item">
                                <strong>Chave PIX:</strong>
                                <span>64172939000116</span>
                            </div>
                            <div class="pix-item">
                                <strong>Nome:</strong>
                                <span>Carlos Robealdo Carvalho</span>
                            </div>
                            <div class="pix-item">
                                <strong>Valor Total:</strong>
                                <span id="pixAmountDisplay">R$ 0,00</span>
                            </div>
                            <button type="button" id="copyPixBtn" class="pix-copy-btn">
                                <i class="fas fa-copy"></i> Copiar Chave PIX
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="message">Observações</label>
                        <textarea id="message" placeholder="Observações importantes..."></textarea>
                    </div>

                    <button type="submit" id="submitButton">
                        <i class="fab fa-whatsapp"></i> Enviar Pedido
                    </button>
                </form>
            </div>

            <!-- Informações -->
            <div class="info-container">
                <h2><i class="fas fa-info-circle"></i> Informações</h2>
                
                <div class="whatsapp-info">
                    <h3><i class="fab fa-whatsapp"></i> Atendimento</h3>
                    <div class="whatsapp-number">
                        <i class="fab fa-whatsapp"></i> (85) 98461-4021
                    </div>
                    <p style="font-size: 0.85rem;">Segunda a Domingo, 8h às 18h</p>
                </div>
                
                <div class="instructions">
                    <h3><i class="fas fa-list-ol"></i> Como Funciona</h3>
                    <ol>
                        <li>Informe o primeiro dia da sua ultima menstruação</li>
                        <li>Calcule suas semanas de gestação</li>
                        <li>Veja a quantidade recomendada para o seu periodo</li>
                        <li>Escolha como deseja receber (entregador ou SEDEX)</li>
                        <li>Se escolher SEDEX, calcule o frete</li>
                        <li>Preencha seus dados e envie o pedido</li>
                    </ol>
                </div>
                
                <div class="whatsapp-message-preview">
                    <h3><i class="fab fa-whatsapp"></i> Preview:</h3>
                    <div id="messagePreview">
                        Informe os dados para ver o preview do pedido...
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label style="font-size: 0.9rem;">Link WhatsApp:</label>
                    <div class="copy-btn-container">
                        <input type="text" id="whatsappURL" readonly placeholder="Link será gerado aqui...">
                        <button type="button" id="copyButton">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p><strong>Compra Segura - Misoprostol 100% Original</strong></p>
            <p>WhatsApp: (85)98461-4021 | PIX: Carlos Robealdo - 64172939000116</p>
            <p style="font-size: 0.8rem; margin-top: 5px;">Suporte Total do inicio ao fim do procedimento</p>
        </footer>
    </div>

    <script>
        // Configurações ATUALIZADAS
        const WHATSAPP_NUMBER = "5585984614021"; // Número atualizado com código do Brasil (55)
        const WHATSAPP_DISPLAY = "(85) 98461-4021"; // Formatação para exibição
        
        // Informações atualizadas
        const PIX_KEY = "64172939000116";
        const PIX_NAME = "Carlos Robealdo";
        const ORIGIN_CEP = "04119000"; // São Paulo - SP - CEP DE ORIGEM
        
        // Tabela de produtos atualizada
        const PRODUCTS = [
            { id: 1, name: "Quantidade: 1", price: 300.00 },
            { id: 2, name: "Quantidade: 2", price: 450.00 },
            { id: 3, name: "Quantidade: 3", price: 600.00 },
            { id: 4, name: "Quantidade: 4", price: 750.00 },
            { id: 5, name: "Quantidade: 5", price: 900.00 },
            { id: 6, name: "Quantidade: 6", price: 950.00 },
            { id: 7, name: "Quantidade:7", price: 1100.00 },
            { id: 8, name: "Quantidade: 8", price: 1250.00 },
            { id: 9, name: "Quantidade: 9", price: 1400.00 },
            { id: 10, name: "Quantidade: 10", price: 1550.00 },
            { id: 11, name: "Quantidade: 11", price: 1700.00 },
            { id: 12, name: "Quantidade: 12", price: 1750.00 },
            { id: 13, name: "Quantidade: 13", price: 1900.00 },
            { id: 14, name: "Quantidade: 14", price: 2050.00 },
            { id: 15, name: "Quantidade: 15", price: 2200.00 },
            { id: 16, name: "Quantidade: 16", price: 2450.00 }
        ];

        // TABELA DE FRETE SEDEX COM MARGEM DE SEGURANÇA (≈20%)
        // Origem: São Paulo/SP (CEP: 04119-000)
        const SHIPPING_RATES = {
            'SP': { cost: 30.00, minDays: 1, maxDays: 3 },    // São Paulo
            'RJ': { cost: 38.00, minDays: 3, maxDays: 5 },    // Rio de Janeiro
            'MG': { cost: 41.00, minDays: 3, maxDays: 6 },    // Minas Gerais
            'ES': { cost: 43.00, minDays: 3, maxDays: 6 },    // Espírito Santo
            'PR': { cost: 46.00, minDays: 3, maxDays: 6 },    // Paraná
            'SC': { cost: 48.00, minDays: 4, maxDays: 7 },    // Santa Catarina
            'RS': { cost: 50.00, minDays: 4, maxDays: 8 },    // Rio Grande do Sul
            'MS': { cost: 53.00, minDays: 5, maxDays: 9 },    // Mato Grosso do Sul
            'MT': { cost: 58.00, minDays: 5, maxDays: 10 },   // Mato Grosso
            'GO': { cost: 48.00, minDays: 4, maxDays: 8 },    // Goiás
            'DF': { cost: 50.00, minDays: 4, maxDays: 8 },    // Distrito Federal
            'BA': { cost: 58.00, minDays: 5, maxDays: 10 },   // Bahia
            'SE': { cost: 60.00, minDays: 5, maxDays: 11 },   // Sergipe
            'AL': { cost: 60.00, minDays: 5, maxDays: 11 },   // Alagoas
            'PE': { cost: 58.00, minDays: 5, maxDays: 10 },   // Pernambuco
            'PB': { cost: 63.00, minDays: 6, maxDays: 12 },   // Paraíba
            'RN': { cost: 65.00, minDays: 6, maxDays: 12 },   // Rio Grande do Norte
            'CE': { cost: 65.00, minDays: 6, maxDays: 12 },   // Ceará
            'PI': { cost: 68.00, minDays: 6, maxDays: 13 },   // Piauí
            'MA': { cost: 70.00, minDays: 7, maxDays: 14 },   // Maranhão
            'PA': { cost: 72.00, minDays: 7, maxDays: 15 },   // Pará
            'TO': { cost: 68.00, minDays: 6, maxDays: 13 },   // Tocantins
            'RO': { cost: 75.00, minDays: 8, maxDays: 16 },   // Rondônia
            'AC': { cost: 78.00, minDays: 8, maxDays: 17 },   // Acre
            'AM': { cost: 82.00, minDays: 9, maxDays: 18 },   // Amazonas
            'RR': { cost: 85.00, minDays: 10, maxDays: 20 },  // Roraima
            'AP': { cost: 82.00, minDays: 9, maxDays: 18 },   // Amapá
            'default': { cost: 85.00, minDays: 10, maxDays: 20 } // Demais estados (caso algum não esteja listado)
        };

        // Elementos
        const calculateBtn = document.getElementById('calculateBtn');
        const lastPeriodInput = document.getElementById('lastPeriod');
        const currentDateInput = document.getElementById('currentDate');
        const pregnancyResult = document.getElementById('pregnancyResult');
        const noDataMessage = document.getElementById('noDataMessage');
        const weeksDisplay = document.getElementById('weeksDisplay');
        const weeksDisplayText = document.getElementById('weeksDisplayText');
        const pixAmountDisplay = document.getElementById('pixAmountDisplay');
        const customerForm = document.getElementById('customerForm');
        const submitButton = document.getElementById('submitButton');
        const messagePreview = document.getElementById('messagePreview');
        const whatsappURLInput = document.getElementById('whatsappURL');
        const copyButton = document.getElementById('copyButton');
        const copyPixBtn = document.getElementById('copyPixBtn');
        const searchCepBtn = document.getElementById('searchCep');
        const shippingCalculation = document.getElementById('shippingCalculation');
        const calculateShippingBtn = document.getElementById('calculateShippingBtn');
        const shippingResult = document.getElementById('shippingResult');
        const shippingCostElement = document.getElementById('shippingCost');
        const shippingTimeElement = document.getElementById('shippingTime');
        const totalSummary = document.getElementById('totalSummary');
        const totalAmount = document.getElementById('totalAmount');
        const summaryDetails = document.getElementById('summaryDetails');
        const productsTableBody = document.getElementById('productsTableBody');
        const selectedProductInfo = document.getElementById('selectedProductInfo');
        const productCalculation = document.getElementById('productCalculation');
        const calcProductName = document.getElementById('calcProductName');
        const calcProductPrice = document.getElementById('calcProductPrice');
        const calcShipping = document.getElementById('calcShipping');
        const calcTotal = document.getElementById('calcTotal');
        const calcTotalDisplay = document.getElementById('calcTotalDisplay');
        const loadingCep = document.getElementById('loadingCep');
        const destinationStateElement = document.getElementById('destinationState');
        
        // Elementos do endereço
        const cepInput = document.getElementById('cep');
        const streetInput = document.getElementById('street');
        const neighborhoodInput = document.getElementById('neighborhood');
        const cityInput = document.getElementById('city');
        const stateInput = document.getElementById('state');
        
        // Variáveis
        let currentWeeks = 0;
        let deliveryType = 'hand'; // 'hand' ou 'sedex'
        let shippingCost = 0;
        let totalValue = 0;
        let selectedTableProduct = null; // Produto selecionado na tabela
        let currentState = ''; // Estado atual do cliente

        // Inicializar datas
        function initializeDates() {
            const today = new Date();
            currentDateInput.value = today.toISOString().split('T')[0];
            currentDateInput.max = currentDateInput.value;
            
            lastPeriodInput.max = currentDateInput.value;
            
            noDataMessage.classList.remove('hidden');
            pregnancyResult.classList.add('hidden');
        }

        // Criar tabela de produtos
        function createProductsTable() {
            productsTableBody.innerHTML = '';
            
            PRODUCTS.forEach(product => {
                const row = document.createElement('tr');
                row.dataset.productId = product.id;
                
                row.innerHTML = `
                    <td class="product-radio">
                        <input type="radio" name="selectedProduct" id="product${product.id}" value="${product.id}">
                    </td>
                    <td class="product-number">${product.name}</td>
                    <td class="product-price-cell">R$ ${product.price.toFixed(2).replace('.', ',')}</td>
                `;
                
                // Adicionar evento de clique na linha inteira
                row.addEventListener('click', (e) => {
                    if (e.target.type !== 'radio') {
                        const radio = row.querySelector('input[type="radio"]');
                        radio.checked = !radio.checked;
                        if (radio.checked) {
                            radio.dispatchEvent(new Event('change'));
                        }
                    }
                });
                
                // Adicionar evento de change no radio
                const radio = row.querySelector('input[type="radio"]');
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        // Remover seleção de outras linhas
                        document.querySelectorAll('#productsTableBody tr').forEach(tr => {
                            tr.classList.remove('selected');
                        });
                        
                        // Adicionar seleção na linha atual
                        row.classList.add('selected');
                        
                        // Atualizar produto selecionado
                        selectedTableProduct = product;
                        updateSelectedProductInfo();
                        updateProductCalculation();
                        updateTotalSummary();
                        updateMessagePreview();
                        
                        showNotification(` ${product.id} selecionado: R$ ${product.price.toFixed(2)}`, 'success');
                    }
                });
                
                productsTableBody.appendChild(row);
            });
        }

        // Atualizar informações do produto selecionado
        function updateSelectedProductInfo() {
            if (!selectedTableProduct) {
                selectedProductInfo.innerHTML = `
                    <i class="fas fa-info-circle" style="font-size: 1.5rem; margin-bottom: 10px; display: block;"></i>
                    <p>Selecione um produto da tabela acima</p>
                `;
                selectedProductInfo.className = 'no-product-selected';
                productCalculation.classList.add('hidden');
                return;
            }
            
            selectedProductInfo.innerHTML = `
                <div class="selected-product-display">
                    <i class="fas fa-check-circle"></i> ${selectedTableProduct.name}
                </div>
                <div style="font-size: 1.5rem; font-weight: bold; margin: 5px 0;">
                    R$ ${selectedTableProduct.price.toFixed(2).replace('.', ',')}
                </div>
                <p style="font-size: 0.9rem; margin-top: 5px;">
                    Você escolheu ${selectedTableProduct.name}
                </p>
            `;
            selectedProductInfo.className = 'product-selection-info';
            productCalculation.classList.remove('hidden');
        }

        // Atualizar cálculo do produto
        function updateProductCalculation() {
            if (!selectedTableProduct) return;
            
            calcProductName.textContent = selectedTableProduct.name;
            calcProductPrice.textContent = `R$ ${selectedTableProduct.price.toFixed(2).replace('.', ',')}`;
            
            // Atualizar shipping cost se já calculado
            const shippingValue = deliveryType === 'sedex' ? shippingCost : 0;
            calcShipping.textContent = deliveryType === 'sedex' && shippingCost > 0 
                ? `R$ ${shippingCost.toFixed(2).replace('.', ',')}` 
                : deliveryType === 'sedex' ? 'A calcular' : 'Grátis';
            
            // Calcular total
            const total = selectedTableProduct.price + (deliveryType === 'sedex' ? shippingCost : 0);
            calcTotal.textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
            calcTotalDisplay.textContent = `TOTAL: R$ ${total.toFixed(2).replace('.', ',')}`;
        }

        // Configurar opções de entrega
        function setupDeliveryOptions() {
            const deliveryOptions = document.querySelectorAll('.delivery-option');
            
            deliveryOptions.forEach(option => {
                option.addEventListener('click', function() {
                    deliveryOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    const radio = this.querySelector('input[type="radio"]');
                    radio.checked = true;
                    
                    deliveryType = this.dataset.type;
                    
                    if (deliveryType === 'sedex') {
                        // Verificar se CEP já foi preenchido
                        const cep = cepInput.value.replace(/\D/g, '');
                        if (cep.length === 8 && streetInput.value.trim() !== '') {
                            shippingCalculation.classList.remove('hidden');
                            // Atualizar destino do frete
                            destinationStateElement.textContent = `${currentState} - ${stateInput.value}`;
                        } else {
                            showNotification('Preencha o CEP primeiro para calcular o frete SEDEX', 'info');
                        }
                        shippingResult.classList.add('hidden');
                    } else {
                        shippingCalculation.classList.add('hidden');
                        shippingResult.classList.add('hidden');
                        shippingCost = 0;
                    }
                    
                    updateProductCalculation();
                    updateTotalSummary();
                    updateMessagePreview();
                });
            });
        }

        // Calcular semanas de gestação (SIMPLIFICADO)
        function calculatePregnancyWeeks() {
            if (!lastPeriodInput.value) {
                showNotification('Informe a data da sua última menstruação', 'error');
                return false;
            }
            
            const lastPeriod = new Date(lastPeriodInput.value);
            const currentDate = new Date(currentDateInput.value);
            
            if (lastPeriod > currentDate) {
                showNotification('A data da menstruação não pode ser futura', 'error');
                return false;
            }
            
            const diffTime = Math.abs(currentDate - lastPeriod);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const weeks = Math.floor(diffDays / 7);
            
            if (weeks > 42) {
                showNotification('Não aconselhamos o Misoprostol com período superior a 22 semanas.', 'info');
                return false;
            }
            
            return weeks;
        }

        // Atualizar display das semanas
        function updateWeeksDisplay(weeks) {
            currentWeeks = weeks;
            
            weeksDisplay.textContent = weeks;
            weeksDisplayText.textContent = weeks;
            
            noDataMessage.classList.add('hidden');
            pregnancyResult.classList.remove('hidden');
            
            showNotification(`${weeks} semanas calculadas!`, 'success');
        }

        // Validar CEP
        function validateCEP(cep) {
            return cep.replace(/[^\d]+/g, '').length === 8;
        }

        // Buscar CEP
        async function fetchAddressByCEP(cep) {
            const cleanCEP = cep.replace(/\D/g, '');
            if (cleanCEP.length !== 8) return null;
            
            try {
                // Usar a API ViaCEP
                const response = await fetch(`https://viacep.com.br/ws/${cleanCEP}/json/`);
                const data = await response.json();
                
                if (data.erro) {
                    return null;
                }
                
                return {
                    logradouro: data.logradouro || '',
                    bairro: data.bairro || '',
                    localidade: data.localidade || '',
                    uf: data.uf || ''
                };
            } catch (error) {
                console.error('Erro ao buscar CEP:', error);
                return null;
            }
        }

        // Preencher endereço com dados da API
        function fillAddress(data) {
            streetInput.value = data.logradouro || '';
            neighborhoodInput.value = data.bairro || '';
            cityInput.value = data.localidade || '';
            stateInput.value = data.uf || '';
            currentState = data.uf || '';
            
            // Atualizar destino do frete
            if (data.uf) {
                destinationStateElement.textContent = `${getStateName(data.uf)} - ${data.uf}`;
            }
            
            // Habilitar o botão de calcular frete se SEDEX estiver selecionado
            if (deliveryType === 'sedex') {
                shippingCalculation.classList.remove('hidden');
            }
            
            updateMessagePreview();
            showNotification('Endereço encontrado!', 'success');
        }

        // Obter nome completo do estado
        function getStateName(uf) {
            const states = {
                'AC': 'Acre', 'AL': 'Alagoas', 'AP': 'Amapá', 'AM': 'Amazonas',
                'BA': 'Bahia', 'CE': 'Ceará', 'DF': 'Distrito Federal', 'ES': 'Espírito Santo',
                'GO': 'Goiás', 'MA': 'Maranhão', 'MT': 'Mato Grosso', 'MS': 'Mato Grosso do Sul',
                'MG': 'Minas Gerais', 'PA': 'Pará', 'PB': 'Paraíba', 'PR': 'Paraná',
                'PE': 'Pernambuco', 'PI': 'Piauí', 'RJ': 'Rio de Janeiro', 'RN': 'Rio Grande do Norte',
                'RS': 'Rio Grande do Sul', 'RO': 'Rondônia', 'RR': 'Roraima', 'SC': 'Santa Catarina',
                'SP': 'São Paulo', 'SE': 'Sergipe', 'TO': 'Tocantins'
            };
            return states[uf] || uf;
        }

        // Calcular frete SEDEX - USANDO A TABELA EXATA FORNECIDA
        function calculateShipping() {
            const cep = cepInput.value.replace(/\D/g, '');
            
            if (!cep || cep.length !== 8) {
                showNotification('Informe um CEP válido para calcular o frete', 'error');
                return;
            }
            
            const state = stateInput.value.toUpperCase();
            
            if (!state || state.length !== 2) {
                showNotification('Informe o estado para calcular o frete', 'error');
                return;
            }
            
            const btn = calculateShippingBtn;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Calculando...';
            btn.disabled = true;
            
            // Simular cálculo baseado no estado de destino
            setTimeout(() => {
                // Buscar o valor do frete na tabela
                let shippingRate;
                
                if (SHIPPING_RATES[state]) {
                    shippingRate = SHIPPING_RATES[state];
                } else {
                    shippingRate = SHIPPING_RATES.default;
                }
                
                shippingCost = shippingRate.cost;
                
                shippingCostElement.textContent = `R$ ${shippingCost.toFixed(2).replace('.', ',')}`;
                shippingTimeElement.textContent = `Prazo: ${shippingRate.minDays}-${shippingRate.maxDays} dias úteis`;
                
                shippingResult.classList.remove('hidden');
                
                btn.innerHTML = '<i class="fas fa-calculator"></i> Calcular Frete SEDEX';
                btn.disabled = false;
                
                updateProductCalculation();
                updateTotalSummary();
                
                const stateName = getStateName(state);
                showNotification(`Frete calculado para ${stateName}: R$ ${shippingCost.toFixed(2)}`, 'success');
            }, 1500);
        }

        // Atualizar resumo total
        function updateTotalSummary() {
            if (!selectedTableProduct) {
                totalAmount.textContent = "R$ 0,00";
                pixAmountDisplay.textContent = "R$ 0,00";
                summaryDetails.textContent = "Selecione um produto da tabela";
                return;
            }
            
            // Calcular total
            const productValue = selectedTableProduct.price;
            let total;
            let details;
            
            if (deliveryType === 'sedex') {
                if (shippingCost > 0) {
                    total = productValue + shippingCost;
                    details = `Produto: R$ ${productValue.toFixed(2).replace('.', ',')} + Frete: R$ ${shippingCost.toFixed(2).replace('.', ',')} = Total: R$ ${total.toFixed(2).replace('.', ',')}`;
                } else {
                    total = productValue;
                    details = `Produto: R$ ${productValue.toFixed(2).replace('.', ',')} + Frete: A calcular`;
                }
            } else {
                total = productValue;
                details = `Produto: R$ ${productValue.toFixed(2).replace('.', ',')} + Entrega: Grátis = Total: R$ ${total.toFixed(2).replace('.', ',')}`;
            }
            
            totalAmount.textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
            totalAmount.style.fontSize = "2rem";
            pixAmountDisplay.textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
            summaryDetails.textContent = details;
            
            totalValue = total;
        }

        // Validar CPF
        function validateCPF(cpf) {
            cpf = cpf.replace(/[^\d]+/g, '');
            if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
            
            let sum = 0;
            for (let i = 1; i <= 9; i++) sum += parseInt(cpf[i-1]) * (11 - i);
            let remainder = (sum * 10) % 11;
            if (remainder === 10 || remainder === 11) remainder = 0;
            if (remainder !== parseInt(cpf[9])) return false;
            
            sum = 0;
            for (let i = 1; i <= 10; i++) sum += parseInt(cpf[i-1]) * (12 - i);
            remainder = (sum * 10) % 11;
            if (remainder === 10 || remainder === 11) remainder = 0;
            return remainder === parseInt(cpf[10]);
        }

        // Notificação
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();
            
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        // Atualizar preview da mensagem
        function updateMessagePreview() {
            if (!selectedTableProduct) {
                messagePreview.textContent = "Informe os dados para ver o preview do pedido...";
                return;
            }
            
            const name = document.getElementById('name').value || '[Não informado]';
            const email = document.getElementById('email').value || '[Não informado]';
            const phone = document.getElementById('phone').value || '[Não informado]';
            const cpf = document.getElementById('cpf').value || '[Não informado]';
            const cep = document.getElementById('cep').value || '[Não informado]';
            const street = document.getElementById('street').value || '[Não informado]';
            const number = document.getElementById('number').value || '[Não informado]';
            const complement = document.getElementById('complement').value || '';
            const neighborhood = document.getElementById('neighborhood').value || '[Não informado]';
            const city = document.getElementById('city').value || '[Não informado]';
            const state = document.getElementById('state').value || '[Não informado]';
            const message = document.getElementById('message').value || '';
            
            // Calcular total
            const productValue = selectedTableProduct.price;
            const shippingValue = deliveryType === 'sedex' ? shippingCost : 0;
            const total = productValue + shippingValue;
            
            // Informações de entrega
            const deliveryInfo = deliveryType === 'hand' 
                ? "📦 *ENTREGA:* Receber em mãos (entregador) - SEM TAXA DE ENTREGA"
                : shippingCost > 0 
                    ? `📦 *ENTREGA:* Envio via SEDEX\n   • Valor do Frete: R$ ${shippingCost.toFixed(2).replace('.', ',')}\n   • Prazo: ${document.getElementById('shippingTime').textContent || 'A calcular'}\n   • Origem: São Paulo/SP (CEP: 04119-000)\n   • Destino: ${state} - ${getStateName(state)}`
                    : "📦 *ENTREGA:* Envio via SEDEX - Frete a calcular";
            
            // Adicionar semanas de gestação se calculado
            const pregnancyInfo = currentWeeks > 0 
                ? `\n🤰 *INFORMAÇÕES DA GESTAÇÃO:*\n• Semanas de gestação: ${currentWeeks} semanas`
                : '';
            
            const previewText = `🛒 *COMPRA SEGURA - MISOPROSTOL (CYTOTEC)*

👤 *DADOS DO CLIENTE:*
• Nome: ${name}
• Email: ${email}
• WhatsApp: ${phone}
• CPF: ${cpf}
${pregnancyInfo}

🛍️ *PRODUTO SELECIONADO:*
• ${selectedTableProduct.name}
• Valor: R$ ${productValue.toFixed(2).replace('.', ',')}

🧮 *CÁLCULO DO PEDIDO:*
• Produto: R$ ${productValue.toFixed(2).replace('.', ',')}
• Frete: ${deliveryType === 'sedex' && shippingCost > 0 ? `R$ ${shippingValue.toFixed(2).replace('.', ',')}` : deliveryType === 'sedex' ? 'A calcular' : 'Grátis'}
• *TOTAL A PAGAR:* R$ ${total.toFixed(2).replace('.', ',')}

${deliveryInfo}

📍 *ENDEREÇO DE ENTREGA:*
• ${street}, ${number} ${complement ? '- ' + complement : ''}
• ${neighborhood} - ${city}/${state}
• CEP: ${cep}

💳 *PAGAMENTO PIX:*
• Chave: ${PIX_KEY}
• Nome: ${PIX_NAME}
• Valor Total: R$ ${total.toFixed(2).replace('.', ',')}

📝 *OBSERVAÇÕES:*
${message || 'Nenhuma observação adicional'}

⏰ *Pedido realizado em:* ${new Date().toLocaleString('pt-BR')}
🆔 *Código do Pedido:* PED-${Math.random().toString(36).substr(2, 6).toUpperCase()}`;
            
            messagePreview.textContent = previewText;
            generateWhatsAppURL(previewText);
        }

        // Gerar URL
        function generateWhatsAppURL(message) {
            whatsappURLInput.value = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
        }

        // Event Listeners
        calculateBtn.addEventListener('click', () => {
            const weeks = calculatePregnancyWeeks();
            if (weeks !== false) {
                updateWeeksDisplay(weeks);
                updateMessagePreview();
            }
        });

        // Botão calcular frete
        calculateShippingBtn.addEventListener('click', () => {
            calculateShipping();
        });

        // Máscaras
        document.getElementById('cpf').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            }
            e.target.value = value;
        });

        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                if (value.length <= 2) value = value.replace(/(\d{0,2})/, '($1');
                else if (value.length <= 7) value = value.replace(/(\d{2})(\d{0,5})/, '($1) $2');
                else value = value.replace(/(\d{2})(\d{5})(\d{0,4})/, '($1) $2-$3');
            }
            e.target.value = value;
        });

        // Máscara e autocomplete do CEP
        cepInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 8) {
                if (value.length > 5) value = value.replace(/(\d{5})(\d)/, '$1-$2');
            }
            e.target.value = value;
        });

        // Buscar CEP pelo botão
        searchCepBtn.addEventListener('click', async function() {
            const cep = cepInput.value;
            if (!validateCEP(cep)) {
                showNotification('Digite um CEP válido (8 números)', 'error');
                return;
            }
            
            loadingCep.classList.add('show');
            this.disabled = true;
            this.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            
            try {
                const data = await fetchAddressByCEP(cep);
                if (data) {
                    fillAddress(data);
                } else {
                    showNotification('CEP não encontrado. Preencha manualmente.', 'error');
                }
            } catch (error) {
                showNotification('Erro ao buscar endereço', 'error');
                console.error('Erro:', error);
            } finally {
                loadingCep.classList.remove('show');
                this.disabled = false;
                this.innerHTML = '<i class="fas fa-search"></i> Buscar';
            }
        });

        // Buscar CEP automaticamente ao digitar 8 números
        cepInput.addEventListener('blur', async function() {
            const cep = cepInput.value.replace(/\D/g, '');
            if (cep.length === 8) {
                loadingCep.classList.add('show');
                
                try {
                    const data = await fetchAddressByCEP(cep);
                    if (data) {
                        fillAddress(data);
                    }
                } catch (error) {
                    console.error('Erro ao buscar CEP:', error);
                } finally {
                    loadingCep.classList.remove('show');
                }
            }
        });

        // Copiar PIX
        copyPixBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(PIX_KEY)
                .then(() => showNotification('Chave PIX copiada!', 'success'))
                .catch(() => showNotification('Erro ao copiar', 'error'));
        });

        // Copiar link
        copyButton.addEventListener('click', () => {
            if (!whatsappURLInput.value.includes('wa.me')) {
                showNotification('Gere o pedido primeiro', 'error');
                return;
            }
            navigator.clipboard.writeText(whatsappURLInput.value)
                .then(() => showNotification('Link copiado!', 'success'))
                .catch(() => showNotification('Erro ao copiar', 'error'));
        });

        // Enviar formulário
        customerForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!selectedTableProduct) {
                showNotification('Selecione um produto da tabela', 'error');
                return;
            }
            
            // Validar se frete foi calculado quando for SEDEX
            if (deliveryType === 'sedex' && shippingCost === 0) {
                showNotification('Calcule o frete SEDEX primeiro', 'error');
                return;
            }
            
            const required = ['name', 'email', 'phone', 'cpf', 'cep', 'street', 'number', 'neighborhood', 'city', 'state'];
            for (const field of required) {
                if (!document.getElementById(field).value.trim()) {
                    showNotification('Preencha todos os campos obrigatórios', 'error');
                    return;
                }
            }
            
            if (!validateCPF(document.getElementById('cpf').value)) {
                showNotification('CPF inválido', 'error');
                return;
            }
            
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
            
            setTimeout(() => {
                window.open(whatsappURLInput.value, '_blank');
                showNotification('Pedido enviado para WhatsApp!', 'success');
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fab fa-whatsapp"></i> Enviar Pedido';
            }, 1000);
        });

        // Atualizar preview quando campos mudarem
        document.querySelectorAll('#customerForm input, #customerForm textarea').forEach(input => {
            input.addEventListener('input', updateMessagePreview);
        });

        // Atualizar quando opções de entrega mudam
        document.querySelectorAll('input[name="delivery"]').forEach(radio => {
            radio.addEventListener('change', updateMessagePreview);
        });

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            initializeDates();
            setupDeliveryOptions();
            createProductsTable();
            
            // Mostrar resumo total desde o início
            totalSummary.classList.remove('hidden');
            
            showNotification('Selecione um produto da tabela para iniciar seu pedido', 'info');
        });
    </script>
</body>
</html>
