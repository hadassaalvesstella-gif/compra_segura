<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compra Segura - Misoprostol 100% Original</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.5;
            padding: 15px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 25px;
            padding: 20px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border-radius: 12px;
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.2);
        }

        header h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
        }

        header p {
            font-size: 0.95rem;
            opacity: 0.95;
            max-width: 600px;
            margin: 0 auto;
        }

        .content {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            justify-content: space-between;
        }

        .calculator-container, .form-container, .info-container {
            flex: 1;
            min-width: 300px;
            background-color: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        .calculator-container {
            border-top: 4px solid #6a11cb;
        }

        .form-container {
            border-top: 4px solid #2575fc;
        }

        .info-container {
            border-top: 4px solid #00b09b;
        }

        h2 {
            color: #2c3e50;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title {
            color: #6a11cb;
            margin: 15px 0 10px 0;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .calculator-box {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e0e7ff;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 6px;
            font-weight: 600;
            color: #444;
            font-size: 0.9rem;
        }

        input, select, textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            transition: border 0.2s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #6a11cb;
            box-shadow: 0 0 0 2px rgba(106, 17, 203, 0.1);
        }

        .error-message {
            color: #e74c3c;
            font-size: 0.8rem;
            margin-top: 4px;
            display: none;
        }

        textarea {
            min-height: 80px;
            resize: vertical;
        }

        .row {
            display: flex;
            gap: 10px;
        }

        .row .form-group {
            flex: 1;
        }

        .pregnancy-result {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin-top: 15px;
        }

        .weeks-display {
            font-size: 2.5rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .product-info {
            background: linear-gradient(135deg, #00b09b 0%, #96c93d 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }

        .product-price {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 8px 0;
        }

        .product-name {
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .negotiation-checkbox {
            margin-top: 15px;
            padding: 10px;
            background: #fff3cd;
            border-radius: 6px;
            border: 1px solid #ffeaa7;
        }

        .negotiation-checkbox label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            font-weight: 600;
            color: #856404;
            margin: 0;
        }

        .negotiation-checkbox input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }

        .delivery-options {
            margin-top: 15px;
            padding: 15px;
            background: #e8f4fc;
            border-radius: 8px;
            border: 1px solid #b3e0ff;
        }

        .delivery-option {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 6px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .delivery-option:hover {
            background: rgba(255, 255, 255, 0.5);
        }

        .delivery-option.selected {
            background: white;
            border: 2px solid #2575fc;
            box-shadow: 0 2px 8px rgba(37, 117, 252, 0.2);
        }

        .delivery-option input[type="radio"] {
            width: 18px;
            height: 18px;
        }

        .delivery-option .icon {
            font-size: 1.5rem;
            color: #2575fc;
        }

        .delivery-option .details {
            flex: 1;
        }

        .delivery-option .title {
            font-weight: 600;
            color: #2c3e50;
        }

        .delivery-option .description {
            font-size: 0.85rem;
            color: #666;
            margin-top: 2px;
        }

        .shipping-calculation {
            background: #f8f9ff;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #e0e7ff;
        }

        .shipping-result {
            background: linear-gradient(135deg, #2575fc 0%, #6a11cb 100%);
            color: white;
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
            text-align: center;
        }

        .shipping-result.hidden {
            display: none;
        }

        .shipping-cost {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 5px 0;
        }

        .shipping-time {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .pix-section {
            background: linear-gradient(135deg, #2575fc 0%, #6a11cb 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }

        .pix-details {
            background-color: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 6px;
            margin-top: 10px;
        }

        .pix-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            font-size: 0.9rem;
        }

        .pix-item:last-child {
            border-bottom: none;
        }

        .pix-copy-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid white;
            color: white;
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            width: 100%;
            justify-content: center;
        }

        .pix-copy-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-1px);
        }

        button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 15px;
        }

        button:hover {
            background: linear-gradient(135deg, #5a0db9 0%, #1c68e8 100%);
            transform: translateY(-2px);
        }

        button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
        }

        .whatsapp-info {
            background: linear-gradient(135deg, #25D366 0%, #128C7E 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }

        .whatsapp-number {
            font-size: 1.2rem;
            font-weight: bold;
            background-color: rgba(255, 255, 255, 0.2);
            padding: 10px 15px;
            border-radius: 25px;
            display: inline-block;
            margin: 8px 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 100%;
        }

        .whatsapp-message-preview {
            background-color: #f8f9fa;
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 0.85rem;
            white-space: pre-wrap;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
        }

        .instructions {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border: 1px solid #e0e0e0;
        }

        .instructions h3 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .instructions ol {
            padding-left: 20px;
            font-size: 0.85rem;
        }

        .instructions li {
            margin-bottom: 6px;
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .row {
                flex-direction: column;
                gap: 0;
            }
            
            header h1 {
                font-size: 1.5rem;
            }
            
            .weeks-display {
                font-size: 2rem;
            }
        }

        footer {
            text-align: center;
            margin-top: 25px;
            padding: 15px;
            color: #7f8c8d;
            font-size: 0.85rem;
            border-top: 1px solid #e0e0e0;
        }

        .notification {
            position: fixed;
            top: 15px;
            right: 15px;
            padding: 12px 18px;
            border-radius: 6px;
            color: white;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            animation: slideIn 0.3s ease;
            font-size: 0.9rem;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .notification.success {
            background: #2ecc71;
        }

        .notification.error {
            background: #e74c3c;
        }

        .notification.info {
            background: #3498db;
        }
        
        .required {
            color: #e74c3c;
        }
        
        .cep-search {
            display: flex;
            gap: 8px;
            align-items: center;
        }
        
        .cep-search input {
            flex: 1;
        }
        
        .cep-search button {
            width: auto;
            padding: 10px 15px;
            margin: 0;
            font-size: 0.9rem;
            white-space: nowrap;
            background: #3498db;
        }
        
        .cep-search button:hover {
            background: #2980b9;
        }
        
        .copy-btn-container {
            display: flex;
            gap: 8px;
            margin-top: 8px;
        }
        
        .copy-btn-container input {
            flex: 1;
        }
        
        .copy-btn-container button {
            width: auto;
            padding: 10px 15px;
            margin: 0;
            background: #2ecc71;
        }
        
        .copy-btn-container button:hover {
            background: #27ae60;
        }
        
        .no-data {
            text-align: center;
            color: #7f8c8d;
            font-style: italic;
            padding: 20px;
        }
        
        .calculate-shipping-btn {
            background: #00b09b !important;
            margin-top: 10px !important;
        }
        
        .calculate-shipping-btn:hover {
            background: #00a187 !important;
        }
        
        .total-summary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            text-align: center;
        }
        
        .total-amount {
            font-size: 2rem;
            font-weight: bold;
            margin: 8px 0;
        }
        
        .shipping-origin {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
            background: white;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
           <h1><i class="fa-solid fa-pills"></i> Compra Segura - Misoprostol 100% Original </h1>
            <p>Calcule quantas semanas voc√™ est√° e veja a quantidade recomendada <br> Suporte Total do inicio ao fim do procedimento</p>
        </header>

        <div class="content">
            <!-- Calculadora -->
            <div class="calculator-container">
                <h2><i class="fas fa-calculator"></i> Calculadora</h2>
                
                <div class="calculator-box">
                    <div class="form-group">
                        <label for="lastPeriod">Primeiro dia da √∫ltima menstrua√ß√£o *</label>
                        <input type="date" id="lastPeriod" required>
                    </div>
                    
                    <!-- Data Atual OCULTA -->
                    <div class="form-group hidden">
                        <label for="currentDate">Data Atual *</label>
                        <input type="date" id="currentDate" required>
                    </div>
                    
                    <button type="button" id="calculateBtn">
                        <i class="fas fa-calculator"></i> Calcular Semanas
                    </button>
                </div>
                
                <div id="pregnancyResult" class="hidden">
                    <div class="pregnancy-result">
                        <div class="weeks-display" id="weeksDisplay">0</div>
                        <div>Semanas de Gesta√ß√£o</div>
                        <div style="margin-top: 5px; font-size: 0.9rem;" id="periodDisplay">
                            Per√≠odo: <span id="periodRange">0-0 semanas</span>
                        </div>
                    </div>
                    
                    <div class="product-info">
                        <div class="product-name" id="productName">Selecione uma data para calcular</div>
                        <div class="product-price" id="productPrice">R$ 0,00</div>
                    </div>
                    
                    <!-- Checkbox para Negocia√ß√£o -->
                    <div class="negotiation-checkbox">
                        <label>
                            <input type="checkbox" id="negotiateCheckbox">
                            <i class="fas fa-handshake"></i> Quero Negociar
                        </label>
                    </div>
                </div>
                
                <div id="noDataMessage" class="no-data">
                    <i class="fas fa-calculator" style="font-size: 2rem; margin-bottom: 10px; color: #ddd;"></i>
                    <p>Informe a data da sua √∫ltima menstrua√ß√£o para calcular as semanas de gesta√ß√£o</p>
                </div>
            </div>

            <!-- Formul√°rio -->
            <div class="form-container">
                <h2><i class="fas fa-user"></i> Dados Pessoais</h2>
                <form id="customerForm">
                    <div class="section-title">
                        <i class="fas fa-user"></i> Informa√ß√µes
                    </div>
                    
                    <div class="form-group">
                        <label for="name">Nome Completo *</label>
                        <input type="text" id="name" placeholder="Seu nome completo" required>
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <label for="email">E-mail *</label>
                            <input type="email" id="email" placeholder="seu@email.com" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">WhatsApp *</label>
                            <input type="tel" id="phone" placeholder="(85) 98461-4021" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="cpf">CPF *</label>
                        <input type="text" id="cpf" placeholder="000.000.000-00" required>
                        <div class="error-message" id="cpfError">CPF inv√°lido</div>
                    </div>

                    <div class="section-title">
                        <i class="fas fa-map-marker-alt"></i> Endere√ßo
                    </div>
                    
                    <div class="form-group">
                        <label for="cep">CEP *</label>
                        <div class="cep-search">
                            <input type="text" id="cep" placeholder="00000-000" required>
                            <button type="button" id="searchCep">
                                <i class="fas fa-search"></i> Buscar
                            </button>
                        </div>
                        <div class="error-message" id="cepError">CEP inv√°lido</div>
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <label for="street">Rua *</label>
                            <input type="text" id="street" placeholder="Nome da rua" required>
                        </div>
                        <div class="form-group">
                            <label for="number">N√∫mero *</label>
                            <input type="text" id="number" placeholder="N¬∫" required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <label for="complement">Complemento</label>
                            <input type="text" id="complement" placeholder="Apto, Casa">
                        </div>
                        <div class="form-group">
                            <label for="neighborhood">Bairro *</label>
                            <input type="text" id="neighborhood" placeholder="Bairro" required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="form-group">
                            <label for="city">Cidade *</label>
                            <input type="text" id="city" placeholder="Cidade" required>
                        </div>
                        <div class="form-group">
                            <label for="state">Estado *</label>
                            <input type="text" id="state" placeholder="UF" required>
                        </div>
                    </div>

                    <!-- Op√ß√µes de Entrega -->
                    <div class="delivery-options">
                        <h3><i class="fas fa-truck"></i> Op√ß√µes de Entrega</h3>
                        
                        <div class="delivery-option selected" data-type="hand">
                            <input type="radio" name="delivery" id="deliveryHand" value="hand" checked>
                            <div class="icon">
                                <i class="fas fa-hand-holding-heart"></i>
                            </div>
                            <div class="details">
                                <div class="title">Receber em m√£os (Motoboy Uber)</div>
                                <div class="description">Verificar Disponibilidade - Sem taxa de entrega</div>
                            </div>
                        </div>
                        
                        <div class="delivery-option" data-type="sedex">
                            <input type="radio" name="delivery" id="deliverySedex" value="sedex">
                            <div class="icon">
                                <i class="fas fa-shipping-fast"></i>
                            </div>
                            <div class="details">
                                <div class="title">Envio via SEDEX</div>
                                <div class="description">Entrega pelos Correios - Frete calculado</div>
                            </div>
                        </div>
                    </div>

                    <!-- C√°lculo do Frete SEDEX -->
                    <div id="shippingCalculation" class="shipping-calculation hidden">
                        <div class="form-group">
                            <label>Origem do Frete:</label>
                            <div class="shipping-origin">
                                <i class="fas fa-map-marker-alt"></i> S√£o Paulo - SP
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label>Peso do Pacote (envelope)</label>
                            <input type="text" value="500g (tamanho padr√£o)" readonly>
                        </div>
                        
                        <button type="button" id="calculateShippingBtn" class="calculate-shipping-btn">
                            <i class="fas fa-calculator"></i> Calcular Frete SEDEX
                        </button>
                        
                        <div id="shippingResult" class="shipping-result hidden">
                            <div class="shipping-cost" id="shippingCost">R$ 0,00</div>
                            <div class="shipping-time" id="shippingTime">Prazo: 0-0 dias √∫teis</div>
                        </div>
                    </div>

                    <!-- Resumo Total -->
                    <div id="totalSummary" class="total-summary">
                        <h3><i class="fas fa-receipt"></i> Resumo do Valor</h3>
                        <div class="total-amount" id="totalAmount">R$ 0,00</div>
                        <div style="font-size: 0.9rem;" id="summaryDetails">
                            Produto: R$ 0,00 + Frete: R$ 0,00
                        </div>
                    </div>

                    <!-- Informa√ß√µes de Pagamento PIX -->
                    <div class="pix-section">
                        <h3><i class="fas fa-money-bill-wave"></i> Pagamento via PIX</h3>
                        <div class="pix-details">
                            <div class="pix-item">
                                <strong>Chave PIX (CNPJ):</strong>
                                <span>64172939000116</span>
                            </div>
                            <div class="pix-item">
                                <strong>Nome:</strong>
                                <span>Carlos Robealdo Carvalho</span>
                            </div>
                            <div class="pix-item">
                                <strong>Valor Total:</strong>
                                <span id="pixAmountDisplay">R$ 0,00</span>
                            </div>
                            <button type="button" id="copyPixBtn" class="pix-copy-btn">
                                <i class="fas fa-copy"></i> Copiar Chave PIX
                            </button>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="message">Observa√ß√µes</label>
                        <textarea id="message" placeholder="Observa√ß√µes importantes..."></textarea>
                    </div>

                    <button type="submit" id="submitButton">
                        <i class="fab fa-whatsapp"></i> Enviar Pedido
                    </button>
                </form>
            </div>

            <!-- Informa√ß√µes -->
            <div class="info-container">
                <h2><i class="fas fa-info-circle"></i> Informa√ß√µes</h2>
                
                <div class="whatsapp-info">
                    <h3><i class="fab fa-whatsapp"></i> Atendimento</h3>
                    <div class="whatsapp-number">
                        <i class="fab fa-whatsapp"></i> (85) 98461-4021
                    </div>
                    <p style="font-size: 0.85rem;">Segunda a Domingo, 8h √†s 18h</p>
                </div>
                
                <div class="instructions">
                    <h3><i class="fas fa-list-ol"></i> Como Funciona</h3>
                    <ol>
                        <li>Informe o primeiro dia da sua ultima menstrua√ß√£o</li>
                        <li>Calcule suas semanas de gesta√ß√£o</li>
                        <li>Veja a quantidade recomendada para o seu periodo</li>
                        <li>Escolha como deseja receber (entregador ou SEDEX)</li>
                        <li>Se escolher SEDEX, calcule o frete</li>
                        <li>Preencha seus dados e envie o pedido</li>
                    </ol>
                </div>
                
                <div class="whatsapp-message-preview">
                    <h3><i class="fab fa-whatsapp"></i> Preview:</h3>
                    <div id="messagePreview">
                        Informe os dados para ver o preview do pedido...
                    </div>
                </div>
                
                <div class="form-group" style="margin-top: 15px;">
                    <label style="font-size: 0.9rem;">Link WhatsApp:</label>
                    <div class="copy-btn-container">
                        <input type="text" id="whatsappURL" readonly placeholder="Link ser√° gerado aqui...">
                        <button type="button" id="copyButton">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <footer>
            <p><strong>Compra Segura - Misoprostol 100% Original</strong></p>
            <p>WhatsApp: (62) 99626-7896 | PIX: Carlos Robealdo - 64172939000116</p>
            <p style="font-size: 0.8rem; margin-top: 5px;">Suporte Total do inicio ao fim do procedimento</p>
        </footer>
    </div>

    <script>
        const WHATSAPP_NUMBER = "5585984614021"; 
        const WHATSAPP_DISPLAY = "(85) 98461-4021"; 
        
        // Informa√ß√µes atualizadas Solictadas La√≠s
        const PIX_KEY = "64172939000116";
        const PIX_NAME = "Carlos Robealdo Carvalho";
        const ORIGIN_CEP = "04119000"; // S√£o Paulo - SP
        
        // Quantidade de comprimidos sugerido por periodo
        const PREGNANCY_PRODUCTS = [
            { minWeeks: 1, maxWeeks: 8, name: "Recomendado 6 comprimidos", price: 950.00 },
            { minWeeks: 9, maxWeeks: 11, name: "Recomendado 9 comprimidos", price: 1250.00 },
            { minWeeks: 12, maxWeeks: 14, name: "Recomendado 12 comprimidos", price: 1750.00 },
            { minWeeks: 15, maxWeeks: 18, name: "Recomendado 14 comprimidos", price: 2150.00 },
            { minWeeks: 19, maxWeeks: 22, name: "Recomendado 16 comprimidos", price: 2450.00 }
        ];

        // Tabela de fretes SEDEX
        const SHIPPING_RATES = {
            'SP': { // S√£o Paulo
                '01000000-01999999': { cost: 12.00, minDays: 1, maxDays: 2 }, // Centro de SP
                '02000000-02999999': { cost: 15.00, minDays: 1, maxDays: 3 }, // Zona Norte
                '03000000-03999999': { cost: 15.00, minDays: 1, maxDays: 3 }, // Zona Leste
                '04000000-04999999': { cost: 14.00, minDays: 1, maxDays: 2 }, // Zona Sul (inclui 04119)
                '05000000-05999999': { cost: 16.00, minDays: 1, maxDays: 3 }, // Zona Oeste
                '06000000-06999999': { cost: 18.00, minDays: 2, maxDays: 4 }, // ABC e regi√£o
                '07000000-07999999': { cost: 20.00, minDays: 2, maxDays: 5 }, // Grande SP Norte
                '08000000-08999999': { cost: 22.00, minDays: 2, maxDays: 5 }, // Grande SP Sul
                '09000000-09999999': { cost: 25.00, minDays: 3, maxDays: 6 }, // Litoral
                'default': { cost: 28.00, minDays: 3, maxDays: 7 } // Demais cidades de SP
            },
            'RJ': { cost: 35.00, minDays: 3, maxDays: 7 }, // Rio de Janeiro
            'MG': { cost: 32.00, minDays: 3, maxDays: 7 }, // Minas Gerais
            'PR': { cost: 30.00, minDays: 3, maxDays: 6 }, // Paran√°
            'SC': { cost: 38.00, minDays: 4, maxDays: 8 }, // Santa Catarina
            'RS': { cost: 42.00, minDays: 4, maxDays: 9 }, // Rio Grande do Sul
            'GO': { cost: 45.00, minDays: 4, maxDays: 9 }, // Goi√°s
            'DF': { cost: 40.00, minDays: 4, maxDays: 8 }, // Distrito Federal
            'default': { cost: 55.00, minDays: 5, maxDays: 12 } // Demais estados
        };

        // Elementos
        const calculateBtn = document.getElementById('calculateBtn');
        const lastPeriodInput = document.getElementById('lastPeriod');
        const currentDateInput = document.getElementById('currentDate');
        const pregnancyResult = document.getElementById('pregnancyResult');
        const noDataMessage = document.getElementById('noDataMessage');
        const weeksDisplay = document.getElementById('weeksDisplay');
        const periodRange = document.getElementById('periodRange');
        const productName = document.getElementById('productName');
        const productPrice = document.getElementById('productPrice');
        const pixAmountDisplay = document.getElementById('pixAmountDisplay');
        const negotiateCheckbox = document.getElementById('negotiateCheckbox');
        const customerForm = document.getElementById('customerForm');
        const submitButton = document.getElementById('submitButton');
        const messagePreview = document.getElementById('messagePreview');
        const whatsappURLInput = document.getElementById('whatsappURL');
        const copyButton = document.getElementById('copyButton');
        const copyPixBtn = document.getElementById('copyPixBtn');
        const searchCepBtn = document.getElementById('searchCep');
        const shippingCalculation = document.getElementById('shippingCalculation');
        const calculateShippingBtn = document.getElementById('calculateShippingBtn');
        const shippingResult = document.getElementById('shippingResult');
        const shippingCostElement = document.getElementById('shippingCost');
        const shippingTimeElement = document.getElementById('shippingTime');
        const totalSummary = document.getElementById('totalSummary');
        const totalAmount = document.getElementById('totalAmount');
        const summaryDetails = document.getElementById('summaryDetails');
        
        // Vari√°veis
        let currentWeeks = 0;
        let currentProduct = null;
        let wantsToNegotiate = false;
        let deliveryType = 'hand'; // 'hand' ou 'sedex'
        let shippingCost = 0;
        let productPriceValue = 0;
        let totalValue = 0;

        // Inicializar datas
        function initializeDates() {
            const today = new Date();
            currentDateInput.value = today.toISOString().split('T')[0];
            currentDateInput.max = currentDateInput.value;
            
            lastPeriodInput.max = currentDateInput.value;
            
            noDataMessage.classList.remove('hidden');
            pregnancyResult.classList.add('hidden');
        }

        // Configurar op√ß√µes de entrega
        function setupDeliveryOptions() {
            const deliveryOptions = document.querySelectorAll('.delivery-option');
            
            deliveryOptions.forEach(option => {
                option.addEventListener('click', function() {
                    deliveryOptions.forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    
                    const radio = this.querySelector('input[type="radio"]');
                    radio.checked = true;
                    
                    deliveryType = this.dataset.type;
                    
                    if (deliveryType === 'sedex') {
                        shippingCalculation.classList.remove('hidden');
                        shippingResult.classList.add('hidden');
                    } else {
                        shippingCalculation.classList.add('hidden');
                        shippingResult.classList.add('hidden');
                    }
                    
                    updateTotalSummary();
                    updateMessagePreview();
                });
            });
        }

        // Calcular semanas - ocutar data atual (Como solicitado) 
        function calculatePregnancyWeeks() {
            if (!lastPeriodInput.value) {
                showNotification('Informe a data da sua √∫ltima menstrua√ß√£o', 'error');
                return false;
            }
            
            const lastPeriod = new Date(lastPeriodInput.value);
            const currentDate = new Date(currentDateInput.value);
            
            if (lastPeriod > currentDate) {
                showNotification('A data da menstrua√ß√£o n√£o pode ser futura', 'error');
                return false;
            }
            
            const diffTime = Math.abs(currentDate - lastPeriod);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const weeks = Math.floor(diffDays / 7);
            
            if (weeks > 42) {
                showNotification('Por favor, consulte seu m√©dico. Per√≠odo superior a 42 semanas.', 'info');
                return false;
            }
            
            return weeks;
        }

        // Encontrar produto
        function findProductForWeeks(weeks) {
            const effectiveWeeks = weeks === 0 ? 1 : weeks;
            return PREGNANCY_PRODUCTS.find(p => 
                effectiveWeeks >= p.minWeeks && effectiveWeeks <= p.maxWeeks
            ) || PREGNANCY_PRODUCTS[0];
        }

        // Atualizar display
        function updateCalculatorDisplay(weeks, product) {
            currentWeeks = weeks;
            currentProduct = product;
            productPriceValue = product.price;
            
            weeksDisplay.textContent = weeks;
            periodRange.textContent = `${product.minWeeks}-${product.maxWeeks} semanas`;
            productName.textContent = product.name;
            
            wantsToNegotiate = negotiateCheckbox.checked;
            
            if (wantsToNegotiate) {
                productPrice.textContent = "Valor a negociar";
                productPrice.style.fontSize = "1.4rem";
            } else {
                productPrice.textContent = `R$ ${product.price.toFixed(2).replace('.', ',')}`;
                productPrice.style.fontSize = "1.8rem";
            }
            
            noDataMessage.classList.add('hidden');
            pregnancyResult.classList.remove('hidden');
            
            updateTotalSummary();
            updateMessagePreview();
            showNotification(`${weeks} semanas calculadas - ${product.name}`, 'success');
        }

        // Calcular frete SEDEX
        function calculateShipping() {
            const cep = document.getElementById('cep').value.replace(/\D/g, '');
            
            if (!cep || cep.length !== 8) {
                showNotification('Informe um CEP v√°lido para calcular o frete', 'error');
                return;
            }
            
            const state = document.getElementById('state').value.toUpperCase();
            
            if (!state || state.length !== 2) {
                showNotification('Informe o estado para calcular o frete', 'error');
                return;
            }
            
            const btn = calculateShippingBtn;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Calculando...';
            btn.disabled = true;
            
            setTimeout(() => {
                let shippingRate;
                
                if (SHIPPING_RATES[state]) {
                    if (typeof SHIPPING_RATES[state] === 'object' && !SHIPPING_RATES[state].cost) {
                        const cepNum = parseInt(cep);
                        for (const range in SHIPPING_RATES[state]) {
                            if (range.includes('-')) {
                                const [min, max] = range.split('-').map(num => parseInt(num));
                                if (cepNum >= min && cepNum <= max) {
                                    shippingRate = SHIPPING_RATES[state][range];
                                    break;
                                }
                            }
                        }
                        if (!shippingRate) {
                            shippingRate = SHIPPING_RATES[state].default;
                        }
                    } else {
                        shippingRate = SHIPPING_RATES[state];
                    }
                } else {
                    shippingRate = SHIPPING_RATES.default;
                }
                
                shippingCost = shippingRate.cost;
                
                shippingCostElement.textContent = `R$ ${shippingCost.toFixed(2).replace('.', ',')}`;
                shippingTimeElement.textContent = `Prazo: ${shippingRate.minDays}-${shippingRate.maxDays} dias √∫teis`;
                
                shippingResult.classList.remove('hidden');
                
                btn.innerHTML = '<i class="fas fa-calculator"></i> Calcular Frete SEDEX';
                btn.disabled = false;
                
                updateTotalSummary();
                showNotification(`Frete calculado: R$ ${shippingCost.toFixed(2)}`, 'success');
            }, 1500);
        }

        // Atualizar resumo total - CORRIGIDO
        function updateTotalSummary() {
            if (!currentProduct) {
                totalAmount.textContent = "R$ 0,00";
                pixAmountDisplay.textContent = "R$ 0,00";
                summaryDetails.textContent = "Produto: R$ 0,00 + Frete: R$ 0,00";
                return;
            }
            
            // Calcular total CORRETAMENTE
            if (wantsToNegotiate) {
                totalValue = 0;
                totalAmount.textContent = "Valor a negociar";
                totalAmount.style.fontSize = "1.6rem";
                pixAmountDisplay.textContent = "Valor a negociar";
                summaryDetails.textContent = "Produto: A negociar + Frete: N√£o aplic√°vel";
            } else {
                let details;
                let productText = `Produto: R$ ${productPriceValue.toFixed(2).replace('.', ',')}`;
                
                if (deliveryType === 'sedex') {
                    if (shippingCost > 0) {
                        totalValue = productPriceValue + shippingCost;
                        details = `${productText} + Frete: R$ ${shippingCost.toFixed(2).replace('.', ',')} = R$ ${totalValue.toFixed(2).replace('.', ',')}`;
                    } else {
                        totalValue = productPriceValue;
                        details = `${productText} + Frete: A calcular`;
                    }
                } else {
                    totalValue = productPriceValue;
                    details = `${productText} + Entrega: Gr√°tis`;
                }
                
                totalAmount.textContent = `R$ ${totalValue.toFixed(2).replace('.', ',')}`;
                totalAmount.style.fontSize = "2rem";
                pixAmountDisplay.textContent = `R$ ${totalValue.toFixed(2).replace('.', ',')}`;
                summaryDetails.textContent = details;
            }
        }

        // Validar CPF
        function validateCPF(cpf) {
            cpf = cpf.replace(/[^\d]+/g, '');
            if (cpf.length !== 11 || /^(\d)\1{10}$/.test(cpf)) return false;
            
            let sum = 0;
            for (let i = 1; i <= 9; i++) sum += parseInt(cpf[i-1]) * (11 - i);
            let remainder = (sum * 10) % 11;
            if (remainder === 10 || remainder === 11) remainder = 0;
            if (remainder !== parseInt(cpf[9])) return false;
            
            sum = 0;
            for (let i = 1; i <= 10; i++) sum += parseInt(cpf[i-1]) * (12 - i);
            remainder = (sum * 10) % 11;
            if (remainder === 10 || remainder === 11) remainder = 0;
            return remainder === parseInt(cpf[10]);
        }

        // Validar CEP
        function validateCEP(cep) {
            return cep.replace(/[^\d]+/g, '').length === 8;
        }

        // Buscar CEP
        async function fetchAddressByCEP(cep) {
            const cleanCEP = cep.replace(/[^\d]+/g, '');
            if (cleanCEP.length !== 8) return null;
            
            try {
                const response = await fetch(`https://viacep.com.br/ws/${cleanCEP}/json/`);
                const data = await response.json();
                return data.erro ? null : data;
            } catch (error) {
                console.error('Erro:', error);
                return null;
            }
        }

        // Notifica√ß√£o
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            
            const existing = document.querySelector('.notification');
            if (existing) existing.remove();
            
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        // Atualizar preview da mensagem - CORRIGIDO (Anteriormente estava dando erro no calculo)
        function updateMessagePreview() {
            if (!currentProduct) {
                messagePreview.textContent = "Informe os dados para ver o preview do pedido...";
                return;
            }
            
            const name = document.getElementById('name').value || '[N√£o informado]';
            const email = document.getElementById('email').value || '[N√£o informado]';
            const phone = document.getElementById('phone').value || '[N√£o informado]';
            const cpf = document.getElementById('cpf').value || '[N√£o informado]';
            const cep = document.getElementById('cep').value || '[N√£o informado]';
            const street = document.getElementById('street').value || '[N√£o informado]';
            const number = document.getElementById('number').value || '[N√£o informado]';
            const complement = document.getElementById('complement').value || '';
            const neighborhood = document.getElementById('neighborhood').value || '[N√£o informado]';
            const city = document.getElementById('city').value || '[N√£o informado]';
            const state = document.getElementById('state').value || '[N√£o informado]';
            const message = document.getElementById('message').value || '';
            
            // Calcular TOTAL CORRETO com frete
            let totalPrice;
            let priceDetails;
            let productValue;
            let shippingValue = 0;
            
            if (wantsToNegotiate) {
                totalPrice = "VALOR A NEGOCIAR";
                priceDetails = "üí≤ *VALOR:* A NEGOCIAR (Cliente manifestou interesse em negociar)";
                productValue = "A negociar";
            } else {
                productValue = productPriceValue;
                
                if (deliveryType === 'hand') {
                    shippingValue = 0;
                    totalPrice = productPriceValue;
                    priceDetails = `üí≤ *VALOR TOTAL:* R$ ${totalPrice.toFixed(2).replace('.', ',')}\n   ‚Ä¢ Produto: R$ ${productValue.toFixed(2).replace('.', ',')}\n   ‚Ä¢ Entrega: Gr√°tis (entregador)`;
                } else if (deliveryType === 'sedex') {
                    shippingValue = shippingCost;
                    if (shippingCost > 0) {
                        totalPrice = productPriceValue + shippingCost;
                        priceDetails = `üí≤ *VALOR TOTAL:* R$ ${totalPrice.toFixed(2).replace('.', ',')}\n   ‚Ä¢ Produto: R$ ${productValue.toFixed(2).replace('.', ',')}\n   ‚Ä¢ Frete SEDEX: R$ ${shippingCost.toFixed(2).replace('.', ',')}\n   ‚Ä¢ *SOMA:* R$ ${productValue.toFixed(2).replace('.', ',')} + R$ ${shippingCost.toFixed(2).replace('.', ',')} = R$ ${totalPrice.toFixed(2).replace('.', ',')}`;
                    } else {
                        totalPrice = productPriceValue;
                        priceDetails = `üí≤ *VALOR DO PRODUTO:* R$ ${productValue.toFixed(2).replace('.', ',')}\n   ‚Ä¢ Frete SEDEX: A calcular`;
                    }
                }
            }
            
            // Informa√ß√µes de entrega
            const deliveryInfo = deliveryType === 'hand' 
                ? "üì¶ *ENTREGA:* Receber em m√£os (entregador) - SEM TAXA DE ENTREGA"
                : shippingCost > 0 
                    ? `üì¶ *ENTREGA:* Envio via SEDEX\n   ‚Ä¢ Valor do Frete: R$ ${shippingCost.toFixed(2).replace('.', ',')}\n   ‚Ä¢ Prazo: ${document.getElementById('shippingTime').textContent || 'A calcular'}`
                    : "üì¶ *ENTREGA:* Envio via SEDEX - Frete a calcular";
            
            const negotiationNote = wantsToNegotiate 
                ? "\n\nüí¨ *OBSERVA√á√ÉO IMPORTANTE:*\nCliente deseja negociar o valor do produto." 
                : "";
            
            // C√°lculo expl√≠cito na mensagem quando for SEDEX
            const totalCalculation = (deliveryType === 'sedex' && shippingCost > 0 && !wantsToNegotiate) 
                ? `\nüßÆ *C√ÅLCULO DO TOTAL:*\n‚Ä¢ Produto: R$ ${productPriceValue.toFixed(2).replace('.', ',')}\n‚Ä¢ Frete SEDEX: R$ ${shippingCost.toFixed(2).replace('.', ',')}\n‚Ä¢ *TOTAL A PAGAR:* R$ ${(productPriceValue + shippingCost).toFixed(2).replace('.', ',')}`
                : "";
            
            const previewText = `ü§∞ *COMPRA SEGURA - MISOPROSTOL (CYTOTEC)*

üë§ *DADOS DA GESTANTE:*
‚Ä¢ Nome: ${name}
‚Ä¢ Email: ${email}
‚Ä¢ WhatsApp: ${phone}
‚Ä¢ CPF: ${cpf}

üìÖ *INFORMA√á√ïES DA GESTA√á√ÉO:*
‚Ä¢ Semanas de gesta√ß√£o: ${currentWeeks} semanas
‚Ä¢ Per√≠odo: ${currentProduct.minWeeks}-${currentProduct.maxWeeks} semanas

üíä *COMPRIMIDOS RECOMENDADO:*
‚Ä¢ Produto: ${currentProduct.name}
${priceDetails}${negotiationNote}

${deliveryInfo}
${totalCalculation}

üìç *ENDERE√áO DE ENTREGA:*
‚Ä¢ ${street}, ${number} ${complement ? '- ' + complement : ''}
‚Ä¢ ${neighborhood} - ${city}/${state}
‚Ä¢ CEP: ${cep}

üí≥ *PAGAMENTO PIX:*
‚Ä¢ Chave: ${PIX_KEY}
‚Ä¢ Nome: ${PIX_NAME}
‚Ä¢ Valor Total: ${typeof totalPrice === 'number' ? `R$ ${totalPrice.toFixed(2).replace('.', ',')}` : totalPrice}

üìù *OBSERVA√á√ïES:*
${message || 'Nenhuma observa√ß√£o adicional'}

‚è∞ *Pedido realizado em:* ${new Date().toLocaleString('pt-BR')}
üÜî *C√≥digo do Pedido:* PED-${Math.random().toString(36).substr(2, 6).toUpperCase()}`;
            
            messagePreview.textContent = previewText;
            generateWhatsAppURL(previewText);
        }

        // Gerar URL
        function generateWhatsAppURL(message) {
            whatsappURLInput.value = `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
        }

        // Event Listeners
        calculateBtn.addEventListener('click', () => {
            const weeks = calculatePregnancyWeeks();
            if (weeks !== false) {
                updateCalculatorDisplay(weeks, findProductForWeeks(weeks));
            }
        });

        // Checkbox de negocia√ß√£o
        negotiateCheckbox.addEventListener('change', () => {
            if (currentProduct) {
                updateCalculatorDisplay(currentWeeks, currentProduct);
            }
        });

        // Bot√£o calcular frete
        calculateShippingBtn.addEventListener('click', () => {
            calculateShipping();
        });

        // M√°scaras
        document.getElementById('cpf').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
            }
            e.target.value = value;
        });

        document.getElementById('phone').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 11) {
                if (value.length <= 2) value = value.replace(/(\d{0,2})/, '($1');
                else if (value.length <= 7) value = value.replace(/(\d{2})(\d{0,5})/, '($1) $2');
                else value = value.replace(/(\d{2})(\d{5})(\d{0,4})/, '($1) $2-$3');
            }
            e.target.value = value;
        });

        document.getElementById('cep').addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length <= 8) {
                if (value.length > 5) value = value.replace(/(\d{5})(\d)/, '$1-$2');
            }
            e.target.value = value;
        });

        // Buscar CEP
        searchCepBtn.addEventListener('click', async function() {
            const cep = document.getElementById('cep').value;
            if (!validateCEP(cep)) {
                showNotification('Digite um CEP v√°lido (8 n√∫meros)', 'error');
                return;
            }
            
            const btn = this;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
            btn.disabled = true;
            
            try {
                const data = await fetchAddressByCEP(cep);
                if (data) {
                    document.getElementById('street').value = data.logradouro || '';
                    document.getElementById('neighborhood').value = data.bairro || '';
                    document.getElementById('city').value = data.localidade || '';
                    document.getElementById('state').value = data.uf || '';
                    showNotification('Endere√ßo encontrado!', 'success');
                    
                    if (deliveryType === 'sedex') {
                        shippingCalculation.classList.remove('hidden');
                    }
                } else {
                    showNotification('CEP n√£o encontrado', 'error');
                }
            } catch (error) {
                showNotification('Erro na busca', 'error');
            } finally {
                btn.innerHTML = '<i class="fas fa-search"></i> Buscar';
                btn.disabled = false;
                updateMessagePreview();
            }
        });

        // Copiar PIX
        copyPixBtn.addEventListener('click', () => {
            navigator.clipboard.writeText(PIX_KEY)
                .then(() => showNotification('Chave PIX copiada!', 'success'))
                .catch(() => showNotification('Erro ao copiar', 'error'));
        });

        // Copiar link
        copyButton.addEventListener('click', () => {
            if (!whatsappURLInput.value.includes('wa.me')) {
                showNotification('Gere o pedido primeiro', 'error');
                return;
            }
            navigator.clipboard.writeText(whatsappURLInput.value)
                .then(() => showNotification('Link copiado!', 'success'))
                .catch(() => showNotification('Erro ao copiar', 'error'));
        });

        // Enviar formul√°rio
        customerForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!currentProduct) {
                showNotification('Calcule as semanas primeiro', 'error');
                return;
            }
            
            // CORRE√á√ÉO: Validar se frete foi calculado quando for SEDEX
            if (deliveryType === 'sedex' && shippingCost === 0) {
                showNotification('Calcule o frete SEDEX primeiro', 'error');
                return;
            }
            
            const required = ['name', 'email', 'phone', 'cpf', 'cep', 'street', 'number', 'neighborhood', 'city', 'state'];
            for (const field of required) {
                if (!document.getElementById(field).value.trim()) {
                    showNotification('Preencha todos os campos obrigat√≥rios', 'error');
                    return;
                }
            }
            
            if (!validateCPF(document.getElementById('cpf').value)) {
                showNotification('CPF inv√°lido', 'error');
                return;
            }
            
            submitButton.disabled = true;
            submitButton.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Enviando...';
            
            setTimeout(() => {
                window.open(whatsappURLInput.value, '_blank');
                showNotification('Pedido enviado para WhatsApp!', 'success');
                submitButton.disabled = false;
                submitButton.innerHTML = '<i class="fab fa-whatsapp"></i> Enviar Pedido';
            }, 1000);
        });

        // Atualizar preview quando campos mudarem
        document.querySelectorAll('#customerForm input, #customerForm textarea').forEach(input => {
            input.addEventListener('input', updateMessagePreview);
        });

        // Atualizar quando op√ß√µes de entrega mudam
        document.querySelectorAll('input[name="delivery"]').forEach(radio => {
            radio.addEventListener('change', updateMessagePreview);
        });

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            initializeDates();
            setupDeliveryOptions();
            
            // Mostrar resumo total desde o in√≠cio
            totalSummary.classList.remove('hidden');
            
            showNotification('Informe o primeiro dia da sua √∫ltima menstrua√ß√£o para calcular', 'info');
        });
    </script>
</body>
</html>
